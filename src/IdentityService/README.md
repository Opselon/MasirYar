# میکروسرویس احراز هویت (IdentityService)

این میکروسرویس مسئولیت تمام عملیات مربوط به کاربران، احراز هویت و مدیریت دسترسی‌ها را بر عهده دارد.

## ساختار پروژه

این پروژه از معماری Clean Architecture پیروی می‌کند و به لایه‌های زیر تقسیم شده است:

- **Core**: شامل موجودیت‌های دامنه (Domain Entities) که وابستگی به هیچ فریم‌ورک خاصی ندارند.
- **Application**: شامل منطق کسب‌وکار و Use Cases.
- **Infrastructure**: شامل پیاده‌سازی‌های فنی مانند دسترسی به دیتابیس، سرویس‌های خارجی و غیره.
- **Api**: لایه ارائه دهنده که شامل کنترلرها و پیکربندی‌های وب است.

## مدل دامنه (Domain Model)

مدل اصلی این سرویس، موجودیت `User` است که در لایه `Core` تعریف شده و شامل اطلاعات اساسی کاربر مانند شناسه، نام کاربری، ایمیل و هش رمز عبور است.

## پشته فنی و وابستگی‌های کلیدی

-   **.NET 9** (نسخه دقیق در `global.json` مشخص شده)
-   **ASP.NET Core:** برای ساخت Web API.
-   **Entity Framework Core (EF Core):** به عنوان ORM برای ارتباط با پایگاه داده.
-   **Npgsql:** درایور مخصوص PostgreSQL برای EF Core.

## پیکربندی و اتصال به پایگاه داده

این سرویس برای ذخیره‌سازی داده‌ها به یک نمونه (Instance) از **PostgreSQL** نیاز دارد.

-   **پیکربندی:** اتصال به پایگاه داده از طریق `IdentityDbContext` در لایه `Infrastructure` مدیریت می‌شود.
-   **رشته اتصال (Connection String):** در فایل `Api/appsettings.Development.json` تعریف شده است و باید به پایگاه داده PostgreSQL که از طریق `docker-compose` راه‌اندازی شده، اشاره کند.
    -   **Host:** `localhost`
    -   **Port:** `5433`

## راهنمای راه‌اندازی سریع

برای راه‌اندازی کامل پروژه در محیط محلی، فقط به **Docker** نیاز دارید. تمام سرویس‌ها، دیتابیس و نیازمندی‌های دیگر به صورت خودکار راه‌اندازی و پیکربندی می‌شوند.

1.  پروژه را از Git دریافت کنید:

    ```shell
    git clone <repo-url>
    cd <project-folder>
    ```

2.  به پوشه `docker` بروید:

    ```shell
    cd docker
    ```

3.  پروژه را با Docker Compose اجرا کنید:

    ```shell
    docker-compose up --build
    ```
    -   آپشن `--build` ایمیج میکروسرویس‌ها را (در صورت نیاز) می‌سازد.
    -   برای اجرای پس‌زمینه، آپشن `-d` را اضافه کنید: `docker-compose up --build -d`

پس از اجرای این دستور، کل پلتفرم به صورت خودکار بالا می‌آید. **Migrationهای دیتابیس نیز به صورت خودکار اعمال می‌شوند.**

-   **API سرویس احراز هویت** در آدرس زیر در دسترس خواهد بود:
    -   `http://localhost:5001/swagger`

## نحوه اجرا (محیط توسعه محلی)

اگر می‌خواهید بدون Docker و به صورت مستقیم روی سیستم خود پروژه را اجرا کنید:

1. مطمئن شوید که PostgreSQL از طریق `docker-compose` در حال اجرا است (یا یک نمونه PostgreSQL محلی در پورت `5433`).
2. پروژه را با دستور `dotnet run --project Api/Api.csproj` اجرا کنید.
3. سرویس بر روی پورت تنظیم شده در `launchSettings.json` در دسترس خواهد بود.
4. Migrationها به صورت خودکار در محیط Development اعمال می‌شوند.

