# لایه Infrastructure

این لایه شامل پیاده‌سازی‌های فنی و جزئیات مربوط به وابستگی‌های خارجی میکروسرویس `IdentityService` است. این لایه به عنوان یک پل بین لایه `Application` و دنیای خارج عمل می‌کند.

## مسئولیت‌ها

-   **دسترسی به داده‌ها:** این لایه شامل پیاده‌سازی رابط‌های مربوط به دسترسی به داده‌ها (مانند `IUserRepository`) است. در این پروژه، از **Entity Framework Core** برای ارتباط با پایگاه داده **PostgreSQL** استفاده شده است.
-   **ارتباط با سرویس‌های خارجی:** اگر میکروسرویس نیاز به ارتباط با سرویس‌های خارجی (مانند سرویس‌های ایمیل، پیامک یا دیگر APIها) داشته باشد، پیاده‌سازی کلاینت‌های مربوطه در این لایه قرار می‌گیرد.
-   **پیاده‌سازی رابط‌های لایه Application:** این لایه مسئولیت پیاده‌سازی رابط‌هایی را که در لایه `Application` تعریف شده‌اند، بر عهده دارد. برای مثال، `UserRepository` در این لایه، رابط `IUserRepository` را پیاده‌سازی می‌کند.

## ساختار

-   `Persistence`: این پوشه شامل تمام کدهای مربوط به پایگاه داده است.
    -   `IdentityDbContext`: کلاس اصلی `DbContext` که نمایانگر یک جلسه (Session) با پایگاه داده است و به ما اجازه می‌دهد تا با موجودیت‌ها کار کنیم.
    -   `Migrations`: شامل کدهای مربوط به مهاجرت‌های پایگاه داده (Database Migrations) است که توسط EF Core تولید می‌شوند.
-   `Repositories`: این پوشه شامل پیاده‌سازی‌های مشخصی از رابط‌های Repository است. برای مثال، `UserRepository` شامل منطق دسترسی به داده‌های کاربران با استفاده از `IdentityDbContext` است.
-   `Services`: این پوشه شامل پیاده‌سازی سرویس‌های خارجی است. برای مثال، `PasswordHasher` که رابط `IPasswordHasher` را پیاده‌سازی می‌کند، در این پوشه قرار دارد.

## اصول طراحی

-   **Dependency Inversion Principle (DIP):** این لایه به اصل وارونگی وابستگی پایبند است. به این معنی که این لایه به لایه `Application` وابسته است، نه برعکس. این کار از طریق پیاده‌سازی رابط‌هایی که در لایه `Application` تعریف شده‌اند، انجام می‌شود.
-   **Separation of Concerns:** این لایه به جداسازی نگرانی‌ها (Separation of Concerns) کمک می‌کند، به طوری که تمام جزئیات مربوط به پیاده‌سازی‌های فنی در یک مکان متمرکز شده و از منطق کسب‌وکار جدا می‌شوند.
